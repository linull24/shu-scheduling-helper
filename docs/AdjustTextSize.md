# 文本大小调整流程
<!--这个文档我懒得写了，懂的都懂 -->
## 主流程

- 开始
  - 过滤有效元素
    - 分离课程名称元素和其他元素
    - 优先处理课程名称元素
  - 对每个元素处理:
    - 重置元素样式
    - 获取初始字体大小
    - 如果是课程名称 -> 应用优先级系数 (×1.4)
    - 进入字体大小调整循环:
      - 检查迭代次数 < 最大迭代次数 (10)
      - 检查字体大小 > 最小字体大小 (10px)
      - 获取元素边界矩形
      - 获取容器边界矩形
      - 检查课程模式
        - 如果是 'full' 或 undefined -> 退出循环
      - 获取容器的 clipPath
      - 解析 clipPath 为多边形顶点
        - 如果解析失败 -> 退出循环
      - 生成元素边界检查点
      - 检查是否有溢出:
        - 对每个检查点:
          - 标准化坐标
          - 判断点是否在多边形内
        - 如果任一点在多边形外 -> 有溢出
      - 如果没有溢出 -> 退出循环
      - 应用缩放比例 (×0.9)
      - 更新字体大小和行高
      - 迭代次数 +1
    - 如果达到最小字体大小:
      - 设置 whiteSpace: 'normal'
      - 设置 wordWrap: 'break-word'
      - 如果是课程名称:
        - 确保最小字符数为 4
        - 检查是否有短行
        - 如果有短行或文本长度 ≤ 4:
          - 设置单行省略模式
          - 确保最小宽度能显示 4 个字符
        - 否则:
          - 设置 overflow: 'visible'
      - 如果不是课程名称:
        - 检查是否有短行
        - 如果有短行:
          - 设置单行省略模式
        - 否则:
          - 设置 overflow: 'visible'
- 结束

## clipPath 解析流程

- 开始
  - 匹配 polygon(...) 格式
    - 如果不匹配 -> 返回 null
  - 分割每个点坐标
  - 对每个点:
    - 清理空白
    - 匹配 x 坐标 (百分比格式)
    - 匹配 y 坐标 (百分比或 calc 格式)
    - 如果坐标无效 -> 跳过此点
    - 标准化 x 坐标到 0-1 范围
    - 标准化 y 坐标:
      - 如果是百分比 -> 除以 100
      - 如果是 calc -> 1 - 值/100
    - 返回标准化坐标 [x, y]
  - 过滤无效点
  - 返回多边形顶点数组
- 结束

## 点在多边形内判断流程

- 开始
  - 检查多边形是否有效
    - 如果无效 -> 返回 false
  - 初始化 inside = false
  - 对多边形每条边:
    - 获取边的两个端点
    - 检查射线与边的交点
    - 如果有交点 -> 切换 inside 状态
  - 返回 inside
- 结束

## 课程名称缩短流程

- 开始
  - 检查部分数组是否为空
    - 如果为空 -> 返回原数组
  - 复制部分数组
  - 寻找可缩短的最长部分:
    - 从后向前遍历
    - 检查是否符合缩短条件
    - 计算可缩短长度
    - 更新最大长度和索引
  - 如果有可缩短部分:
    - 获取部分内容
    - 如果内容长度 > 4:
      - 保留前 4 个字符加省略号
    - 否则:
      - 保持原样
  - 返回处理后的数组
- 结束